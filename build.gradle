plugins {
    id "base"
    id "jacoco"
    id "io.fairyproject" version "1.0.0b7"
}

apply plugin: "java"
apply plugin: "maven-publish"

group = "org.imanity.brew"
version = "0.1b4"

repositories {
    mavenCentral()
    mavenLocal()
    maven { url = "https://papermc.io/repo/repository/maven-public/" }
    maven { url = "https://maven.imanity.dev/repository/imanity-libraries/" }
}

fairy {
    name = "brew"
    version = "0.1b4"

    fairyVersion = "0.5.1b26"

    libraryMode = true
    module("timer", "0.0.1b5")
}

dependencies {
    compileOnly 'org.projectlombok:lombok:1.18.22'
    annotationProcessor "org.projectlombok:lombok:1.18.22"
    compileOnly "org.spigotmc:spigot-api:1.16.5-R0.1-SNAPSHOT"
    testImplementation "org.spigotmc:spigot-api:1.16.5-R0.1-SNAPSHOT"
    testImplementation "org.imanity.spigot:1.16.5:1.16.5"
    compileOnly "org.jetbrains:annotations:22.0.0"
    compileOnly "com.github.ben-manes.caffeine:caffeine:2.9.2"
}

if (findProperty("deploy.imanityLibraries") == "true") {
    tasks.jar.configure {
        classifier = "sources"
    }

    publishing {
        publications {
            shadow(MavenPublication) { publication ->
                from components.java
                pom {
                    name = "Brew " + project.name
                    description = "Brew API"
                }
            }
        }

        repositories {
            maven {
                credentials {
                    username findProperty("imanityLibrariesUsername")
                    password findProperty("imanityLibrariesPassword")
                }
                url "https://maven.imanity.dev/repository/imanity-libraries/"
            }
        }
    }
}

publish.dependsOn build

sourceCompatibility = targetCompatibility = "1.8"
tasks.withType(JavaCompile) {
    options.encoding = "UTF-8"
}

test {
    finalizedBy jacocoTestReport // report is always generated after tests run
}
jacocoTestReport {
    dependsOn test // tests are required to run before generating the report
    reports {
        xml.required = false
        csv.required = false
        html.outputLocation = layout.buildDirectory.dir('jacocoHtml')
    }
}